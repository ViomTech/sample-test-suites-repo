<!DOCTYPE html>
<html>
<head>
    <title>Test Performance Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-matrix@1.1.1/dist/chartjs-chart-matrix.min.js"></script>
    <style>
        .card { margin-bottom: 20px; }
        .table { margin-bottom: 0; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">Test Performance Dashboard</h1>
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">Step Duration Distribution</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="stepDurationChart" height="200"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">Feature-wise Performance</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="featurePerformanceChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">Slowest Steps</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Feature</th>
                                        <th>Scenario</th>
                                        <th>Step</th>
                                        <th>Duration (ms)</th>
                                    </tr>
                                </thead>
                                <tbody id="slowestStepsTable">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">Platform Comparison</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="platformComparisonChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">Scenario Timeline</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="timelineChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">Flagged Steps (Consistently Slow)</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Step</th>
                                        <th>Occurrences</th>
                                        <th>Avg Duration (ms)</th>
                                    </tr>
                                </thead>
                                <tbody id="flaggedStepsTable">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">Step Duration Trends for Slow Steps (Current Run)</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="stepTrendsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Step Duration Distribution Chart
        new Chart(document.getElementById('stepDurationChart'), {
            type: 'bar',
            data: {
                labels: ["check that screen contains fol...","check that screen contains \"Le...","enter \"hema.mahajan@vastuhfc.c...","click \"Submit\"","check that screen contains \"co...","click \"Forward\"","click \"Allow\" inside span","click \"positive\"","check that screen contains \"In...","click \"{el:profile_element}\"","enter \"value\" into \"Type to se...","click \"{el:select-manager}\"","check that \"Completed\" is a li...","enter \"reason\"","check that screen contains \"QC...","enter \"APP1765870764327\" into ...","switch to last opened tab","check that screen contains \"Ap...","[App Launch]","click \"{el:forward}\"","set location permission to all...","check that screen contains \"Ar...","check that screen contains \"fo...","click \"OK\" with exact phrase","click \"View Detailed Progress ...","switch to main tab","click \"OK\"","click \"Log Out\"","check that screen contains \"Co...","click \"Swati Singanjude (VIOM)...","click \"Sign in\"","click \"submit\"","click on the 2nd child with cl...","click \"Credit\" inside span","click \"Link\"","click \"Remark\"","click \"Overall Status\"","enter \"gaurav.g@vastuhfc.com\" ...","click \"Hema Mahajan (004765)\"","enter \"Vastu@123\" into \"Enter ...","click \"{el:qc-complete}\"","click on the 2nd \"Overall Stat...","enter \"add-remark\"","check that screen contains \"Li...","click on the element with clas...","click \"Loan Detail\" with exact...","click on the element with id a..."],
                datasets: [{
                    label: 'Average Duration (ms)',
                    data: [20084.0,2969.0,0.0,1.0,0.0,0.0,136.66666666666666,0.0,242.0,1.0,1.0,31609.0,0.0,1.0,362.0,140.0,1.0,135.5,410.0,0.0,3.6666666666666665,1.0,0.0,0.0,15818.0,0.0,0.0,0.0,319.0,1.0,18458.333333333332,1.0,0.0,3572.5,0.0,0.0,0.0,60.5,60032.0,81.0,32111.0,0.0,0.0,0.0,1162.0,462.5,0.0],
                    backgroundColor: 'rgba(54, 162, 235, 0.5)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    tooltip: {
                        callbacks: {
                            title: function(context) {
                                // Use the full label from the mapping
                                const label = context[0].label;
                                return stepLabelMap[label] || label;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        ticks: {
                            maxRotation: 45,
                            minRotation: 30,
                            autoSkip: false
                        }
                    },
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Feature Performance Chart
        new Chart(document.getElementById('featurePerformanceChart'), {
            type: 'pie',
            data: {
                labels: ["check that screen contains \"completed\"","check that screen contains \"forward\"","click \"Swati Singanjude (VIOM)\"","click \"Submit\"","check that screen contains \"Initiated\"","click \"Forward\"","set location permission to allow","click \"Allow\" inside span","click \"positive\"","enter \"hema.mahajan@vastuhfc.com\" into \"Enter your email\"","click \"{el:profile_element}\"","check that screen contains \"Linked\"","click \"{el:select-manager}\"","check that \"Completed\" is a link","enter \"Vastu@123\" into \"Enter your password\"","check that screen contains following","check that screen contains \"Are you sure you want to link lan?\"","enter \"reason\"","click on the element with id as \"reason\"","click on the 2nd \"Overall Status\"","switch to last opened tab","click on the element with class \"view_button_loan_list\"","click \"{el:forward}\"","[App Launch]","check that screen contains \"QC\"","click \"View Detailed Progress \"","click \"OK\" with exact phrase","switch to main tab","enter \"value\" into \"Type to search\"","click \"OK\"","click \"Log Out\"","click \"Loan Detail\" with exact phrase","click on the element with id as \"user\"","click \"Sign in\"","click \"submit\"","click \"Remark\"","click \"Link\"","click \"Credit\" inside span","enter \"gaurav.g@vastuhfc.com\" into \"Enter your email\"","click \"Overall Status\"","check that screen contains \"Lead\"","enter \"APP1765870764327\" into \"Type to search\"","click on the 2nd child with class \"form_header\"","check that screen contains \"Application Stages\"","click \"Hema Mahajan (004765)\"","check that screen contains \"Completed\"","click \"{el:qc-complete}\"","enter \"add-remark\""],
                datasets: [{
                    data: [0.0,0.0,1.0,1.0,242.0,0.0,3.6666666666666665,136.66666666666666,0.0,0.0,1.0,0.0,31609.0,0.0,81.0,20084.0,1.0,1.0,0.0,0.0,1.0,1162.0,0.0,410.0,362.0,15818.0,0.0,0.0,1.0,0.0,0.0,462.5,0.0,18458.333333333332,1.0,0.0,0.0,3572.5,60.5,0.0,2969.0,140.0,0.0,135.5,60032.0,319.0,32111.0,0.0],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.5)',
                        'rgba(54, 162, 235, 0.5)',
                        'rgba(255, 206, 86, 0.5)',
                        'rgba(75, 192, 192, 0.5)',
                        'rgba(153, 102, 255, 0.5)'
                    ]
                }]
            },
            options: {
                responsive: true
            }
        });

        // Populate Slowest Steps Table
        const slowestSteps = [{"feature":"LoanProcessing.feature","scenario":"AML scenario","step":"check that screen contains following","duration":60251},{"feature":"LoanProcessing.feature","scenario":"Qc scenario","step":"click \"Hema Mahajan (004765)\"","duration":60032},{"feature":"LoanProcessing.feature","scenario":"Lead scenario","step":"click \"Sign in\"","duration":55375},{"feature":"LoanProcessing.feature","scenario":"Qc scenario","step":"click \"{el:qc-complete}\"","duration":32111},{"feature":"LoanProcessing.feature","scenario":"Qc scenario","step":"click \"{el:select-manager}\"","duration":31609},{"feature":"LoanProcessing.feature","scenario":"Dedupe scenario","step":"click \"View Detailed Progress \"","duration":30401},{"feature":"LoanProcessing.feature","scenario":"Lead scenario","step":"click \"Credit\" inside span","duration":7145},{"feature":"LoanProcessing.feature","scenario":"Lead scenario","step":"check that screen contains \"Lead\"","duration":2969},{"feature":"LoanProcessing.feature","scenario":"Lead scenario","step":"click \"View Detailed Progress \"","duration":1235},{"feature":"LoanProcessing.feature","scenario":"Lead scenario","step":"click on the element with class \"view_button_loan_list\"","duration":1162}];
        const tableBody = document.getElementById('slowestStepsTable');
        slowestSteps.forEach(step => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${step.feature}</td>
                <td>${step.scenario}</td>
                <td>${step.step}</td>
                <td>${step.duration}</td>
            `;
            tableBody.appendChild(row);
        });

        // Platform Comparison Chart
        const platformLabels = ["chrome"];
        const platformData = [3117.845810055866];
        new Chart(document.getElementById('platformComparisonChart'), {
            type: 'bar',
            data: {
                labels: platformLabels,
                datasets: [{
                    label: 'Avg Step Duration (ms)',
                    data: platformData,
                    backgroundColor: 'rgba(54, 162, 235, 0.5)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        const scenarioTimeline = [{"feature":"file:///Users/mac/Documents/viom-studio/test_suite_repositories/sample-test-suites-repo-1765884081593/test-suite-1765783670576/execution_20251218_143526/src/test/java/com/nimble/feature/LoanProcessing.feature","scenario":"Lead scenario","start":"2025-12-18T09:05:50.400079Z","end":"2025-12-18T09:07:16.230688Z"},{"feature":"file:///Users/mac/Documents/viom-studio/test_suite_repositories/sample-test-suites-repo-1765884081593/test-suite-1765783670576/execution_20251218_143526/src/test/java/com/nimble/feature/LoanProcessing.feature","scenario":"Qc scenario","start":"2025-12-18T09:07:16.266467Z","end":"2025-12-18T09:09:24.750184Z"},{"feature":"file:///Users/mac/Documents/viom-studio/test_suite_repositories/sample-test-suites-repo-1765884081593/test-suite-1765783670576/execution_20251218_143526/src/test/java/com/nimble/feature/LoanProcessing.feature","scenario":"AML scenario","start":"2025-12-18T09:09:30.483134Z","end":"2025-12-18T09:10:30.777025Z"},{"feature":"file:///Users/mac/Documents/viom-studio/test_suite_repositories/sample-test-suites-repo-1765884081593/test-suite-1765783670576/execution_20251218_143526/src/test/java/com/nimble/feature/LoanProcessing.feature","scenario":"Dedupe scenario","start":"2025-12-18T09:10:37.317831Z","end":"2025-12-18T09:11:08.406725Z"}];

        // Convert ISO strings to Date objects and calculate durations
        const labels = scenarioTimeline.map(s => s.scenario);
        const starts = scenarioTimeline.map(s => new Date(s.start).getTime());
        const ends = scenarioTimeline.map(s => new Date(s.end).getTime());
        const durations = ends.map((end, i) => end - starts[i]);

        const data = {
            labels: labels,
            datasets: [{
                label: 'Execution Time (ms)',
                data: labels.map((_, i) => [starts[i], ends[i]]),
                backgroundColor: 'rgba(75, 192, 192, 0.5)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            }]
        };

        new Chart(document.getElementById('timelineChart'), {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Scenario Execution',
                    data: durations,
                    backgroundColor: 'rgba(75, 192, 192, 0.5)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1,
                    // For horizontal bar
                    indexAxis: 'y'
                }]
            },
            options: {
                indexAxis: 'y',
                scales: {
                    x: {
                        title: { display: true, text: 'Duration (ms)' }
                    }
                }
            }
        });

        const flaggedSteps = [{"avg_duration":60245.333333333336,"count":3,"step":"check that screen contains following"},{"avg_duration":7720.25,"count":12,"step":"click \"Credit\" inside span"},{"avg_duration":60041.333333333336,"count":3,"step":"click \"Hema Mahajan (004765)\""},{"avg_duration":922.3636363636364,"count":11,"step":"click \"Loan Detail\" with exact phrase"},{"avg_duration":23060.25,"count":4,"step":"click \"Sign in\""},{"avg_duration":61591.148148148146,"count":27,"step":"click \"View Detailed Progress \""},{"avg_duration":32367.666666666668,"count":3,"step":"click \"{el:qc-complete}\""},{"avg_duration":32554.333333333332,"count":3,"step":"click \"{el:select-manager}\""},{"avg_duration":1252.0,"count":4,"step":"click on the element with class \"view_button_loan_list\""},{"avg_duration":5715.428571428572,"count":7,"step":"enter \"APP1765870764327\" into \"Type to search\""}];
        const stepTrends = [{"avg_duration":106100.0,"build":"20251215_000157869","step":"[App Launch]"},{"avg_duration":527.0,"build":"20251218_121037828","step":"[App Launch]"},{"avg_duration":810.0,"build":"20251218_142500529","step":"check that screen contains \"Completed\""},{"avg_duration":638.0,"build":"20251218_143538898","step":"check that screen contains \"Completed\""},{"avg_duration":2969.0,"build":"20251218_143538898","step":"check that screen contains \"Lead\""},{"avg_duration":634.0,"build":"20251218_141907031","step":"check that screen contains \"QC\""},{"avg_duration":60248.0,"build":"20251218_141907031","step":"check that screen contains following"},{"avg_duration":60237.0,"build":"20251218_142500529","step":"check that screen contains following"},{"avg_duration":60251.0,"build":"20251218_143538898","step":"check that screen contains following"},{"avg_duration":527.0,"build":"20251218_121037828","step":"click \"Allow\" inside span"},{"avg_duration":20896.0,"build":"20251218_115317697","step":"click \"Credit\" inside span"},{"avg_duration":6482.0,"build":"20251218_115537572","step":"click \"Credit\" inside span"},{"avg_duration":6866.0,"build":"20251218_121037828","step":"click \"Credit\" inside span"},{"avg_duration":5954.0,"build":"20251218_122642437","step":"click \"Credit\" inside span"},{"avg_duration":5516.0,"build":"20251218_123236773","step":"click \"Credit\" inside span"},{"avg_duration":5135.0,"build":"20251218_132953319","step":"click \"Credit\" inside span"},{"avg_duration":5457.0,"build":"20251218_135833584","step":"click \"Credit\" inside span"},{"avg_duration":7067.0,"build":"20251218_140214432","step":"click \"Credit\" inside span"},{"avg_duration":8317.0,"build":"20251218_141014680","step":"click \"Credit\" inside span"},{"avg_duration":6470.0,"build":"20251218_141907031","step":"click \"Credit\" inside span"},{"avg_duration":7338.0,"build":"20251218_142500529","step":"click \"Credit\" inside span"},{"avg_duration":7145.0,"build":"20251218_143538898","step":"click \"Credit\" inside span"},{"avg_duration":60054.0,"build":"20251218_141907031","step":"click \"Hema Mahajan (004765)\""},{"avg_duration":60038.0,"build":"20251218_142500529","step":"click \"Hema Mahajan (004765)\""},{"avg_duration":60032.0,"build":"20251218_143538898","step":"click \"Hema Mahajan (004765)\""},{"avg_duration":1385.0,"build":"20251218_115537572","step":"click \"Loan Detail\" with exact phrase"},{"avg_duration":1014.0,"build":"20251218_121037828","step":"click \"Loan Detail\" with exact phrase"},{"avg_duration":696.0,"build":"20251218_122642437","step":"click \"Loan Detail\" with exact phrase"},{"avg_duration":1054.0,"build":"20251218_123236773","step":"click \"Loan Detail\" with exact phrase"},{"avg_duration":635.0,"build":"20251218_132953319","step":"click \"Loan Detail\" with exact phrase"},{"avg_duration":619.0,"build":"20251218_135833584","step":"click \"Loan Detail\" with exact phrase"},{"avg_duration":599.0,"build":"20251218_140214432","step":"click \"Loan Detail\" with exact phrase"},{"avg_duration":801.0,"build":"20251218_141014680","step":"click \"Loan Detail\" with exact phrase"},{"avg_duration":1250.0,"build":"20251218_141907031","step":"click \"Loan Detail\" with exact phrase"},{"avg_duration":1169.0,"build":"20251218_142500529","step":"click \"Loan Detail\" with exact phrase"},{"avg_duration":924.0,"build":"20251218_143538898","step":"click \"Loan Detail\" with exact phrase"},{"avg_duration":515.0,"build":"20251218_121037828","step":"click \"Sign in\""},{"avg_duration":14471.0,"build":"20251218_132953319","step":"click \"Sign in\""},{"avg_duration":21880.0,"build":"20251218_135833584","step":"click \"Sign in\""},{"avg_duration":55375.0,"build":"20251218_143538898","step":"click \"Sign in\""},{"avg_duration":106100.0,"build":"20251215_000157869","step":"click \"View Detailed Progress \""},{"avg_duration":22346.0,"build":"20251218_115537572","step":"click \"View Detailed Progress \""},{"avg_duration":109317.0,"build":"20251218_121037828","step":"click \"View Detailed Progress \""},{"avg_duration":71771.0,"build":"20251218_122642437","step":"click \"View Detailed Progress \""},{"avg_duration":120023.33333333333,"build":"20251218_123236773","step":"click \"View Detailed Progress \""},{"avg_duration":120020.33333333333,"build":"20251218_132953319","step":"click \"View Detailed Progress \""},{"avg_duration":65648.0,"build":"20251218_135833584","step":"click \"View Detailed Progress \""},{"avg_duration":30281.333333333332,"build":"20251218_140214432","step":"click \"View Detailed Progress \""},{"avg_duration":23052.25,"build":"20251218_141014680","step":"click \"View Detailed Progress \""},{"avg_duration":15547.5,"build":"20251218_141907031","step":"click \"View Detailed Progress \""},{"avg_duration":15729.5,"build":"20251218_142500529","step":"click \"View Detailed Progress \""},{"avg_duration":15818.0,"build":"20251218_143538898","step":"click \"View Detailed Progress \""},{"avg_duration":32931.0,"build":"20251218_141907031","step":"click \"{el:qc-complete}\""},{"avg_duration":32061.0,"build":"20251218_142500529","step":"click \"{el:qc-complete}\""},{"avg_duration":32111.0,"build":"20251218_143538898","step":"click \"{el:qc-complete}\""},{"avg_duration":35079.0,"build":"20251218_141907031","step":"click \"{el:select-manager}\""},{"avg_duration":30975.0,"build":"20251218_142500529","step":"click \"{el:select-manager}\""},{"avg_duration":31609.0,"build":"20251218_143538898","step":"click \"{el:select-manager}\""},{"avg_duration":5860.0,"build":"20251218_122642437","step":"click \"{el:view-case2}\""},{"avg_duration":5646.0,"build":"20251218_121037828","step":"click \"{el:view-case}\""},{"avg_duration":60007.0,"build":"20251218_115537572","step":"click on the element with class \"ant-space css-1tbz80h ant-space-horizontal ant-space-align-center ant-space-gap-row-middle ant-space-gap-col-middle\""},{"avg_duration":60007.0,"build":"20251218_123236773","step":"click on the element with class \"anticon anticon-eye view_button_loan_list\""},{"avg_duration":60008.0,"build":"20251218_135833584","step":"click on the element with class \"anticon anticon-eye view_button_loan_list\""},{"avg_duration":812.0,"build":"20251218_140214432","step":"click on the element with class \"stage_icons\""},{"avg_duration":1587.0,"build":"20251218_141014680","step":"click on the element with class \"view_button_loan_list\""},{"avg_duration":1559.0,"build":"20251218_141907031","step":"click on the element with class \"view_button_loan_list\""},{"avg_duration":700.0,"build":"20251218_142500529","step":"click on the element with class \"view_button_loan_list\""},{"avg_duration":1162.0,"build":"20251218_143538898","step":"click on the element with class \"view_button_loan_list\""},{"avg_duration":2155.0,"build":"20251218_115537572","step":"enter \"APP1765870764327\" into \"Type to search\""},{"avg_duration":913.0,"build":"20251218_121037828","step":"enter \"APP1765870764327\" into \"Type to search\""},{"avg_duration":2737.0,"build":"20251218_123236773","step":"enter \"APP1765870764327\" into \"Type to search\""},{"avg_duration":31158.0,"build":"20251218_132953319","step":"enter \"APP1765870764327\" into \"Type to search\""},{"avg_duration":1155.0,"build":"20251218_141014680","step":"enter \"APP1765870764327\" into \"Type to search\""},{"avg_duration":526.0,"build":"20251218_141907031","step":"enter \"APP1765870764327\" into \"Type to search\""},{"avg_duration":1364.0,"build":"20251218_142500529","step":"enter \"APP1765870764327\" into \"Type to search\""},{"avg_duration":5942.0,"build":"20251218_122642437","step":"hover over \"{el:view-case2}\""}];

        // Populate Flagged Steps Table
        const flaggedTable = document.getElementById('flaggedStepsTable');
        flaggedSteps.forEach(step => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${step.step}</td>
                <td>${step.count}</td>
                <td>${step.avg_duration.toFixed(2)}</td>
            `;
            flaggedTable.appendChild(row);
        });

        // Prepare data for Step Trends Chart
        const builds = [...new Set(stepTrends.map(t => t.build))];
        const steps = [...new Set(stepTrends.map(t => t.step))];
        const datasets = steps.map(step => {
            return {
                label: step,
                data: builds.map(build => {
                    const found = stepTrends.find(t => t.build === build && t.step === step);
                    return found ? found.avg_duration : null;
                }),
                fill: false,
                borderColor: '#' + Math.floor(Math.random()*16777215).toString(16),
                tension: 0.1
            };
        });

        new Chart(document.getElementById('stepTrendsChart'), {
            type: 'line',
            data: {
                labels: builds,
                datasets: datasets
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Step Duration Trends for Slow Steps (Current Run)'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: { display: true, text: 'Avg Duration (ms)' }
                    }
                }
            }
        });
    </script>
</body>
</html>